/*
    Final Project
*/

#include <NewPing.h> 
#include <LiquidCrystal_I2C.h>
#include <Wire.h>


LiquidCrystal_I2C lcd(0x20,16,2);
NewPing sonar(2,3,200);

const unsigned trig =2, echo=3,   //trigger and echo ping for rang finder
                    Pbtn =8, led =10,  //, //Pbtn is the power button and led well... its the led
                    re =12;            //pin for the relay;
         uint8_t state= HIGH, reading , prev = LOW; 
         long t =0, debounce =10;
         char readyto[] = "Ready to ARM";
         char armed[] = "ARMED";
         char* last;
         
        float dist  =0;
        char startDis = 35, endDis = 15;
        long sTime, elapse;

float time = millis();
void power();

void setup()
  {
  
    lcd.init();
    sonar.ping();
    delay(500);
    pinMode(trig,OUTPUT);
    pinMode(echo,INPUT);
    pinMode(Pbtn, INPUT);
    pinMode(led,OUTPUT);
    pinMode(re,OUTPUT);

  }

void loop()
  {
    while(sonar.ping_in() <= startDis )
   {
    
      sTime = millis();
      delay(500);
      lcd.clear();
      lcd.print(sonar.ping_in());
   /*   if(sonar.ping_in() <= endDis)
      {
      elapse = millis() - sTime;
      lcd.clear();
      lcd.print(elapse);
      break;
      }
      *
      delay(500); */
   } 
   if (!digitalRead(Pbtn))
   {
     sTime=0;
     elapse =0;
     lcd.clear();
   }
  
  
  }
  




void power()
   {
     
   reading = digitalRead(Pbtn);
   if(reading == HIGH && prev == LOW && millis()- t > debounce )
   {
     if(state == HIGH)
       state = LOW;
     else
       state = HIGH;
       
       t = millis();
   }
   digitalWrite(re, state);
   digitalWrite(led, state);
   if(state== HIGH && last != armed)
   {
      lcd.clear();
      lcd.print(armed);
      last = armed;
   }
   if(state== LOW && last != readyto)
   {
     lcd.clear();
     lcd.print(readyto);
     last = readyto;
   }
   prev = reading;

     
   }
