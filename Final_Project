/*
    Final Project
*/

#include <NewPing.h> 
#include <LiquidCrystal_I2C.h>
#include <Wire.h>


LiquidCrystal_I2C lcd(0x20,16,2);
NewPing sonar(2,3,200);

const unsigned trig =2, echo=3,   //trigger and echo ping for rang finder
                    Pbtn =8,led =10,  //, //Pbtn is the power button and led well... its the led
                    re =12;            //pin for the relay;
         uint8_t state= HIGH, reading , prev = LOW; 
         long t =0, debounce =10;
         char readyto[] = "Ready to ARM";
         char armed[] = "ARMED";
         char* last;
         
        float dist  = 0.0;
        float startDis = 35.0, endDis = 15.0;
        float  sTime, elapse;

        
int clearLcd();
void power();

void setup()
  {
  
    //lcd.init();
    sonar.ping();
    delay(50);
    pinMode(trig,OUTPUT);
    pinMode(echo,INPUT);
    pinMode(Pbtn, INPUT);
    pinMode(led,OUTPUT);
    pinMode(re,OUTPUT);

  }

void loop()
{
    delay(50);
    while(sonar.ping_in() <= startDis )
   {
      sTime = millis();
      delay(50);
      lcd.print("dist:");
      lcd.print(sonar.ping_in());
      
        if(sonar.ping_in() <= endDis)
           {
              elapse = millis() - sTime;
              lcd.clear();
              lcd.print(elapse);
              digitalWrite(re, LOW);
              break;
           }
   } 
  clearLcd();
/*
 *  add toggle button
 * distance trraveled/elapse time 
 *
 */
  
}

 
 /*
  * Needs to commentted
  */
void power()
{
     
   reading = digitalRead(Pbtn);
   if(reading == HIGH && prev == LOW && millis()- t > debounce )
   {
     if(state == HIGH)
       state = LOW;
     else
       state = HIGH;
       
       t = millis();
   }
   
   digitalWrite(re, state);
   digitalWrite(led, state);
   if(state== HIGH && last != armed)
   {
      lcd.clear();
      lcd.print(armed);
      last = armed;
   }
   if(state== LOW && last != readyto)
   {
     lcd.clear();
     lcd.print(readyto);
     last = readyto;
   }
   prev = reading;

}




int clearLcd()
{
  while (!digitalRead(Pbtn))
   {
     sTime=0;
     elapse =0;
     lcd.clear();
   }
   return 0;
}

